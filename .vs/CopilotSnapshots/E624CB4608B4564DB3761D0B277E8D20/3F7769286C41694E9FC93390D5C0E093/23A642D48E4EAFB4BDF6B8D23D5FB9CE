using System;
using System.Data;
using TijarahJoDB.DAL;
using Models;

namespace TijarahJoDB.BLL
{
	public class PostImage
	{
		public enum enMode { AddNew = 0, Update = 1 };
		public enMode Mode = enMode.AddNew;

		public PostImageModel PostImageModel
		{
			get { return new PostImageModel(PostImageID = this.PostImageID, PostID = this.PostID, PostImageURL = this.PostImageURL, UploadedAt = this.UploadedAt, IsDeleted = this.IsDeleted); }
		}

		public int? PostImageID { set; get; }
		public int PostID { set; get; }
		public string PostImageURL { set; get; }
		public DateTime UploadedAt { set; get; }
		public bool IsDeleted { set; get; }

		public PostImage(PostImageModel PostImageModel, enMode cMode = enMode.AddNew)
		{
			this.PostImageID = PostImageModel.PostImageID;
			this.PostID = PostImageModel.PostID;
			this.PostImageURL = PostImageModel.PostImageURL;
			this.UploadedAt = PostImageModel.UploadedAt;
			this.IsDeleted = PostImageModel.IsDeleted;
			Mode = cMode;
		}

		private bool _AddNewPostImage()
		{
			this.PostImageID = (int?)PostImageData.AddPostImage(PostImageModel);
			return (this.PostImageID != -1);
		}

		private bool _UpdatePostImage()
		{
			return PostImageData.UpdatePostImage(PostImageModel);
		}

		public static PostImage Find(int? PostImageID)
		{
			PostImageModel PostImageModel = PostImageData.GetPostImageByID(PostImageID);

			if (PostImageModel != null)
				return new PostImage(PostImageModel, enMode.Update);
			else
				return null;
		}

		public bool Save()
		{
			switch (Mode)
			{
				case enMode.AddNew:
					if (_AddNewPostImage())
					{
						Mode = enMode.Update;
						return true;
					}
					else
					{
						return false;
					}

				case enMode.Update:
					return _UpdatePostImage();
			}
			return false;
		}

		public static bool DeletePostImage(int? PostImageID)
			=> PostImageData.DeletePostImage(PostImageID);

		public static bool DoesPostImageExist(int? PostImageID)
			=> PostImageData.DoesPostImageExist(PostImageID);

		public static DataTable GetAllTbPostImages()
			=> PostImageData.GetAllTbPostImages();

		/// <summary>
		/// Gets all images for a specific post
		/// </summary>
		public static DataTable GetImagesByPostId(int postId)
			=> PostImageData.GetImagesByPostId(postId);

		/// <summary>
		/// Soft deletes all images for a specific post
		/// </summary>
		/// <param name="postId">The post ID</param>
		/// <returns>Number of images deleted, -1 on error</returns>
		public static int SoftDeleteByPostId(int postId)
			=> PostImageData.SoftDeleteImagesByPostId(postId);

		/// <summary>
		/// Hard deletes all images for a specific post (use with caution)
		/// </summary>
		/// <param name="postId">The post ID</param>
		/// <returns>Number of images deleted, -1 on error</returns>
		public static int HardDeleteByPostId(int postId)
			=> PostImageData.HardDeleteImagesByPostId(postId);
	}
}
